# Инструкция по установке и развертыванию

Это руководство поможет вам установить и настроить все компоненты системы AI Assistant: Chrome расширение, LLM-сервер и MCP-серверы.

## Предварительные требования

- Google Chrome (версия 88+) 
- Python 3.9+ с pip
- Node.js и npm (опционально)
- Docker и Docker Compose (для контейнерного развертывания)

## 1. Установка Chrome Extension

### Метод 1: Из исходного кода

1. **Клонирование репозитория:**
   ```bash
   git clone <repository-url>
   cd ai-assistant-chrome-extension
   ```

2. **Загрузка в Chrome:**
   - Откройте Chrome и перейдите в `chrome://extensions/`
   - Включите "Режим разработчика" (верхний правый угол)
   - Нажмите "Загрузить распакованное расширение"
   - Выберите папку `extension` из клонированного репозитория

3. **Проверка установки:**
   - Расширение должно появиться в списке установленных
   - Иконка расширения должна отображаться в панели инструментов Chrome

### Метод 2: Из ZIP-архива

1. **Загрузите архив с расширением:**
   - Скачайте файл `ai-assistant-extension.zip` из раздела Releases
   
2. **Распакуйте архив:**
   - Извлеките файлы в отдельную папку

3. **Загрузите в Chrome:**
   - Откройте Chrome и перейдите в `chrome://extensions/`
   - Включите "Режим разработчика"
   - Нажмите "Загрузить распакованное расширение"
   - Выберите папку с распакованными файлами

## 2. Настройка LLM Server

### Локальная установка

1. **Подготовка окружения:**
   ```bash
   # Создание виртуального окружения Python
   python -m venv venv
   
   # Активация окружения
   # Windows
   venv\Scripts\activate
   # Linux/MacOS
   source venv/bin/activate
   
   # Установка зависимостей
   pip install -r requirements.txt
   ```

2. **Запуск сервера:**
   ```bash
   python server.py
   
   # Дополнительные параметры:
   # python server.py --host 0.0.0.0 --port 8000 --debug
   ```

3. **Проверка работы сервера:**
   - Откройте браузер и перейдите по адресу: `http://localhost:8000`
   - Или выполните в терминале: `curl http://localhost:8000/api/status`

### Docker установка

1. **Запуск с Docker Compose:**
   ```bash
   docker-compose up -d
   ```

2. **Проверка логов:**
   ```bash
   docker-compose logs -f
   ```

### Настройка реальной LLM модели (опционально)

Для использования реального LLM (вместо демо-ответов) отредактируйте файл `server.py`:

```python
# Пример интеграции с OpenAI
import openai

# Настройка API ключа
openai.api_key = os.environ.get("OPENAI_API_KEY", "your-api-key-here")

# В методе _generate_response класса LLMAgent:
async def _generate_response(self, query: str, context: Dict[str, Any]) -> str:
    response = await openai.ChatCompletion.acreate(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "Ты AI ассистент для анализа веб-страниц."},
            {"role": "user", "content": query}
        ]
    )
    return response.choices[0].message.content
```

## 3. Настройка MCP-серверов

### Подготовка Playwright MCP сервера

1. **Установка зависимостей:**
   ```bash
   # Установка Python пакетов
   pip install -r requirements_mcp.txt
   
   # Установка Playwright
   pip install playwright
   playwright install
   ```

2. **Запуск MCP сервера:**
   ```bash
   python playwright_mcp_server.py
   
   # Для HTTP-транспорта:
   # python playwright_mcp_server.py --transport http --port 3000
   ```

3. **Проверка работы:**
   - MCP сервер должен запуститься без ошибок
   - Логи должны показать успешную инициализацию браузера

### Настройка MCP в расширении Chrome

1. **Включение MCP в расширении:**
   - Откройте настройки расширения (щелкните по иконке → ⚙️)
   - Включите переключатель "MCP серверы"
   - Нажмите "Добавить MCP сервер"

2. **Настройка Playwright MCP:**
   - **Название:** Playwright Server
   - **Команда запуска:** Полный путь к Python, например:
     - Windows: `C:\Python39\python.exe C:\path\to\playwright_mcp_server.py`
     - Linux/MacOS: `/path/to/venv/bin/python /path/to/playwright_mcp_server.py`
   - Включите "Автоматически запускать"

3. **Сохранение настроек:**
   - Нажмите "Сохранить"
   - Проверьте статус подключения

## 4. Тестирование системы

1. **Проверка соединения:**
   - Откройте popup расширения (щелкните по иконке)
   - Индикатор соединения должен быть зеленым

2. **Проверка базовых функций:**
   - Перейдите на любую веб-страницу
   - Нажмите "Анализировать страницу"
   - Расширение должно отправить запрос на сервер и показать результат

3. **Проверка MCP функций:**
   - Убедитесь, что MCP серверы включены в настройках
   - Введите запрос, требующий автоматизации браузера, например:
     "Проанализируй и покажи все ссылки на этой странице"

## Устранение неполадок

### Проблемы с Chrome Extension

1. **Расширение не отображается в Chrome:**
   - Проверьте, включен ли "Режим разработчика"
   - Убедитесь, что вы выбрали правильную папку при загрузке
   - Проверьте наличие ошибок в консоли разработчика (Ctrl+Shift+I → Console)

2. **Не работают горячие клавиши:**
   - Проверьте, не конфликтуют ли клавиши с другими расширениями
   - Перезагрузите страницу (F5) или браузер

### Проблемы с LLM Server

1. **Сервер не запускается:**
   - Убедитесь, что все зависимости установлены
   - Проверьте, не занят ли порт другим приложением
   - Проверьте логи на наличие ошибок

2. **Нет соединения с сервером:**
   - Проверьте, правильно ли указан URL в настройках расширения
   - Убедитесь, что сервер запущен и доступен
   - Проверьте, не блокирует ли брандмауэр соединение

### Проблемы с MCP серверами

1. **MCP сервер не запускается:**
   - Проверьте, установлен ли пакет MCP: `pip install mcp`
   - Убедитесь, что Playwright установлен и настроен
   - Проверьте пути к командам в настройках

2. **Ошибки выполнения MCP команд:**
   - Проверьте логи сервера на наличие ошибок
   - Убедитесь, что браузер может быть инициализирован
   - Проверьте правильность CSS селекторов и URL

## Дополнительные настройки

### Переменные окружения

Создайте файл `.env` в корне проекта:

```
# Настройки сервера
SERVER_HOST=0.0.0.0
SERVER_PORT=8000
DEBUG=false
LOG_LEVEL=info

# API ключи
OPENAI_API_KEY=your_key_here
ANTHROPIC_API_KEY=your_key_here

# MCP настройки
MCP_ENABLED=true
MCP_PLAYWRIGHT_PORT=3000
```

### Настройка HTTPS (продакшн)

Для безопасного использования в продакшене рекомендуется настроить HTTPS:

1. **Генерация сертификатов:**
   ```bash
   openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365 -nodes
   ```

2. **Запуск сервера с HTTPS:**
   ```bash
   uvicorn server:app --host 0.0.0.0 --port 8000 --ssl-keyfile=key.pem --ssl-certfile=cert.pem
   ```

## Обновление компонентов

### Обновление Chrome Extension

1. Внесите изменения в код расширения
2. Обновите версию в `manifest.json`
3. Перезагрузите расширение в `chrome://extensions/`

### Обновление LLM Server

1. Остановите работающий сервер (Ctrl+C или `docker-compose down`)
2. Обновите код
3. Перезапустите сервер (`python server.py` или `docker-compose up -d`)

### Обновление MCP серверов

1. Остановите работающие MCP серверы
2. Обновите код
3. Перезапустите серверы
4. Обновите настройки в расширении, если необходимо